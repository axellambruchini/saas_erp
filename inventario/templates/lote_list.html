{% extends "base.html" %}
{% block content %}
<div class="flex flex-col md:flex-row items-center justify-between mb-6 gap-4">
  <h1 class="text-2xl font-bold text-gray-800">Lotes de producto</h1>

  <form method="get" class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
    <input 
      type="text" 
      name="q" 
      value="{{ request.GET.q }}" 
      placeholder="Buscar (código / producto)" 
      class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
    >
    <select 
      name="estado" 
      class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
    >
      <option value="">Todos</option>
      <option value="OK" {% if request.GET.estado == "OK" %}selected{% endif %}>OK</option>
      <option value="RALLAR" {% if request.GET.estado == "RALLAR" %}selected{% endif %}>Por pan rallado</option>
      <option value="VENCIDO" {% if request.GET.estado == "VENCIDO" %}selected{% endif %}>Vencido</option>
    </select>
    <button class="bg-panaderia text-white px-4 py-2 rounded-md hover:bg-yellow-500 transition-colors">
      Filtrar
    </button>
  </form>
</div>

<div class="overflow-x-auto">
  <table class="min-w-full bg-white border border-gray-200 rounded-lg shadow-sm">
    <thead class="bg-gray-100 text-gray-700 uppercase text-sm">
      <tr>
        <th class="py-3 px-4 text-left">Código</th>
        <th class="py-3 px-4 text-left">Producto</th>
        <th class="py-3 px-4 text-left">Prod.</th>
        <th class="py-3 px-4 text-left">Vence</th>
        <th class="py-3 px-4 text-right">Días</th>
        <th class="py-3 px-4 text-right">Disp.</th>
        <th class="py-3 px-4 text-left">Estado</th>
      </tr>
    </thead>
    <tbody class="text-gray-700">
      {% for l in lotes %}
      <tr class="border-t hover:bg-gray-50">
        <td class="py-2 px-4">
          <a href="{% url 'inventario:lote_detail' l.pk %}" class="text-blue-600 hover:underline">{{ l.codigo }}</a>
        </td>
        <td class="py-2 px-4">{{ l.producto }}</td>
        <td class="py-2 px-4">{{ l.fecha_produccion|date:"d-m-Y" }}</td>
        <td class="py-2 px-4">{{ l.fecha_vencimiento|date:"d-m-Y" }}</td>
        <td class="py-2 px-4 text-right">{{ l.dias_restantes }}</td>
        <td class="py-2 px-4 text-right">{{ l.cantidad_disponible_fmt }}</td>
        <td class="py-2 px-4">
          {% if l.estado == "OK" %}
            <span class="px-2 py-1 rounded text-sm font-medium bg-green-100 text-green-700">OK</span>
          {% elif l.estado == "RALLAR" %}
            <span class="px-2 py-1 rounded text-sm font-medium bg-yellow-100 text-yellow-700">Por pan rallado</span>
          {% else %}
            <span class="px-2 py-1 rounded text-sm font-medium bg-red-100 text-red-700">Vencido</span>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="7" class="text-center py-4 text-gray-500">Sin lotes.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
